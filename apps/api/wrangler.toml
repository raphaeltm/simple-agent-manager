name = "workspaces-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]
port = 8787

[vars]
BASE_DOMAIN = "workspaces.example.com"
VERSION = "0.1.0"

# D1 Database
[[d1_databases]]
binding = "DATABASE"
database_name = "workspaces-dev"
database_id = "your-d1-database-id"

# KV for sessions
[[kv_namespaces]]
binding = "KV"
id = "your-kv-namespace-id"

# R2 for VM Agent binaries
[[r2_buckets]]
binding = "R2"
bucket_name = "workspaces-dev-assets"

# Environment-specific configuration
[env.staging]
name = "workspaces-api-staging"
vars = { BASE_DOMAIN = "staging.workspaces.example.com", VERSION = "0.1.0" }

[[env.staging.d1_databases]]
binding = "DATABASE"
database_name = "workspaces-staging"
database_id = "your-staging-d1-id"

[[env.staging.kv_namespaces]]
binding = "KV"
id = "your-staging-kv-id"

[[env.staging.r2_buckets]]
binding = "R2"
bucket_name = "workspaces-staging-assets"

[env.production]
name = "workspaces-api"
vars = { BASE_DOMAIN = "workspaces.example.com", VERSION = "0.1.0" }

[[env.production.d1_databases]]
binding = "DATABASE"
database_name = "workspaces"
database_id = "your-production-d1-id"

[[env.production.kv_namespaces]]
binding = "KV"
id = "your-production-kv-id"

[[env.production.r2_buckets]]
binding = "R2"
bucket_name = "workspaces-assets"

# Cron trigger for provisioning timeout checks (every 5 minutes)
[triggers]
crons = ["*/5 * * * *"]

# Secrets (set via wrangler secret put):
# - GITHUB_CLIENT_ID
# - GITHUB_CLIENT_SECRET
# - GITHUB_APP_ID
# - GITHUB_APP_PRIVATE_KEY
# - CF_API_TOKEN
# - CF_ZONE_ID
# - JWT_PRIVATE_KEY
# - JWT_PUBLIC_KEY
# - ENCRYPTION_KEY
